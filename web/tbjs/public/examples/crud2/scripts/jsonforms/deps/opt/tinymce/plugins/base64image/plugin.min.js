tinymce.PluginManager.add("base64image",function(e,t){var n=e.getParam("max_image_count")||10,i=e.getParam("max_image_size")||512e3,a=e.getParam("max_image_size")||1024,r=e.getParam("max_image_size")||1024;ASSERT.ofTbType(n,"number","TinyMCE base64: imageCountLimit %s must be a number",n),ASSERT.ofTbType(i,"number","TinyMCE base64: imageSizeLimit %s must be a number",i),ASSERT.ofTbType(a,"number","TinyMCE base64: imageHeightLimit %s must be a number",a),ASSERT.ofTbType(r,"number","TinyMCE base64: imageWidthLimit %s must be a number",r);var s=function(t){if(window.File&&window.FileReader&&window.FileList&&window.Blob){for(var s,o=document.getElementsByName("tb-jf-tinymce-base64-img")[0].files,m=new FileReader,p=0;s=o[p];p++)var g=s.size;if(this.parent()&&this.parent().parent())var c=this.parent().parent();if(g>i)return e.windowManager.open({title:"Error: fileSizee exceeds limits",width:450,height:80,html:'<p style="font-size:14px;padding:30px;">The image is too big. It must be 500KB or less.</p>',buttons:[{text:"OK",onclick:function(){this.parent()&&this.parent().parent()&&this.parent().parent().close()}}]}),void c.close();var d=$(e.getBody()),l=d.find("img").length+d.find(".tb-jf-tinymce-base64-img-bg").length;if(l>=n)return e.windowManager.open({title:"Error: too many images",width:450,height:80,html:'<p style="font-size:14px;padding:30px;">The number of images in the editor cannot be higher than '+n+". Please delete an image and try again.</p>",buttons:[{text:"OK",onclick:function(){this.parent()&&this.parent().parent()&&this.parent().parent().close()}}]}),void c.close();m.onload=function(n){if(!(g>i)){var s=n.target.result,o=new Image;if(o.src=s,o.height>a||o.width>r)e.windowManager.open({title:"Error: dimensions exceed limits",width:450,height:80,html:'<p style="font-size:14px;padding:30px;">The image cannot be more than '+r+" pixels wide or "+a+" pixels high.</p>",buttons:[{text:"OK",onclick:function(){this.parent()&&this.parent().parent()&&this.parent().parent().close()}}]}),c.close();else if(t){var m=(e.dom.getRoot(),e.getContent({format:"raw"})),p=document.createElement("div");p.innerHTML=m,p.querySelector(".tb-jf-tinymce-base64-img-bg")&&(m=p.querySelector(".tb-jf-tinymce-base64-img-bg").innerHTML);var d="background-image: url('"+s+"');background-repeat: no-repeat; background-position: top center;",l='<div class="tb-jf-tinymce-base64-img-bg" style="'+d+'">'+m+"</div>";e.setContent(""),e.execCommand("mceReplaceContent",!1,l)}else e.execCommand("mceInsertContent",!1,"<img src='"+s+"' />")}},m.onerror=function(e){ASSERT.isDefined(e,"TinyMCE error: %s",e.getMessage())},o.length>0?m.readAsDataURL(o[0]):e.windowManager.open({title:"Error: no file selected",width:450,height:80,html:'<p style="font-size:14px;padding:30px;">Please select a file before clicking the insert button.</p>',buttons:[{text:"OK",onclick:function(){this.parent()&&this.parent().parent()&&this.parent().parent().close()}}]})}else e.windowManager.open({title:"Error: unsupported browser",width:450,height:80,html:'<p style="font-size:14px;padding:30px;">Please use a modern browser.</p>',buttons:[{text:"OK",onclick:function(){this.parent()&&this.parent().parent()&&this.parent().parent().close()}}]});this.parent()&&this.parent().parent()&&this.parent().parent().close()};e.addCommand("base64image",function(){e.windowManager.open({title:"Insert embedded image",width:450,height:80,html:'<input type="file" class="input" name="tb-jf-tinymce-base64-img" style="font-size:14px;padding:30px;" accept="image/png, image/gif, image/jpeg, image/jpg"/>',buttons:[{text:"Insert as image",subtype:"primary",onclick:function(){s.call(this,!1)}},{text:"Insert as background",subtype:"primary",onclick:function(){s.call(this,!0)}},{text:"Cancel",onclick:function(){this.parent()&&this.parent().parent()&&this.parent().parent().close()}}]})}),e.addButton("base64image",{cmd:"base64image",icon:"image",context:"insert",title:"Insert embedded image"}),e.addMenuItem("base64image",{cmd:"base64image",context:"insert",text:"Insert embedded image",icon:"image",prependToContext:!0})});